# HEADER
Bootstrap: localimage
From: /home/adeel/current/containers/fairroot.sif

# SECTIONS
%setup
    
    mkdir ${SINGULARITY_ROOTFS}/pandaroot
    cp -R ./v12.0.3 ${SINGULARITY_ROOTFS}/pandaroot

%post
    
    # *** Setting up PandaRoot
    mkdir /pandaroot/build /pandaroot/install
    
    # *** Build PandaRoot
    # cd /pandaroot
    # cmake -S ./v12.0.3 -B ./build -DCMAKE_INSTALL_PREFIX=./install
    # cmake --build ./build -j8   # note install is empty
    
    # *** Install PandaRoot
    # cd ./build && make install -j8
    # cd ..

    # OR, Build & Install PandaRoot
    cd /pandaroot/build
    cmake -DCMAKE_INSTALL_PREFIX=../install ../v12.0.3
    make -j8 && make install
    
    # *** Cleanup
    rm -rf /pandaroot/src 
    rm -rf /pandaroot/build
   
%environment
    
    # Export PandaRoot
    source /pandaroot/install/bin/config.sh -p
    
%runscript
    
    exec /bin/bash --noprofile "$@"


%labels

    Author: "Adeel Akram <adeel.akram@physics.uu.se>"
    Dated: 11-07-2021
 
%help
    
    PandaRoot container based on FairSoft and FairRoot containers.
